# ============================================
# Application Configuration
# ============================================

spring:
  application:
    name: invoice-extractor-api

  # ============================================
  # Database Configuration (H2)
  # ============================================
  datasource:
    url: jdbc:h2:mem:invoicedb
    driver-class-name: org.h2.Driver
    username: sa
    password:

  # ============================================
  # JPA/Hibernate Configuration
  # ============================================
  jpa:
    hibernate:
      ddl-auto: create  # Crear tablas automáticamente
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.H2Dialect

  # ============================================
  # SQL Initialization - DESHABILITADO
  # Usamos DataInitializer en su lugar
  # ============================================
  sql:
    init:
      mode: never  # ⭐ NO usar data.sql

  # ============================================
  # H2 Console (solo para desarrollo)
  # ============================================
  h2:
    console:
      enabled: true
      path: /h2-console

  # ============================================
  # Jackson Configuration
  # ============================================
  jackson:
    serialization:
      write-dates-as-timestamps: false
      indent-output: true
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null

  # ============================================
  # File Upload Configuration
  # ============================================
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB

# ============================================
# Server Configuration
# ============================================
server:
  port: 8080
  servlet:
    context-path: /
  error:
    include-message: always
    include-binding-errors: always

# ============================================
# JWT Configuration - COMPLETO
# ============================================
jwt:
  secret: ${JWT_SECRET:mySecretKeyForJWTTokenGenerationThatIsVeryLongAndSecure123456789}
  expiration: 86400000  # 24 hours in milliseconds
  issuer: ${JWT_ISSUER:invoice-extractor-api}
  header: ${JWT_HEADER:Authorization}
  prefix: ${JWT_PREFIX:Bearer }

# ============================================
# Application Custom Properties
# ============================================
app:
  name: Invoice Extractor API
  version: 1.0.0
  description: AI-powered invoice data extraction engine

  # CORS Configuration
  cors:
    allowed-origins: http://localhost:3000,http://localhost:4200
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS
    allowed-headers: "*"
    max-age: 3600

  # Jobs Configuration
  jobs:
    cleanup-cron: "0 0 2 * * ?"  # ⭐ NUEVO - Ejecutar a las 2 AM todos los días
    cleanup-days: 7  # ⭐ NUEVO - Eliminar jobs más antiguos que 7 días

# ============================================
# Docling Configuration
# ============================================
docling:
  mode: api  # api or cli
  api:
    url: ${DOCLING_API_URL:http://localhost:5000}
    timeout: 60000  # 60 seconds
  cli:
    path: ${DOCLING_CLI_PATH:/usr/local/bin/docling}
  temp:
    dir: ${java.io.tmpdir}/docling

# ============================================
# Logging Configuration
# ============================================
logging:
  level:
    root: INFO
    com.atina.invoice.api: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%X{correlationId}] %-5level %logger{36} - %msg%n"

# ============================================
# Actuator Configuration
# ============================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

# ============================================
# Swagger/OpenAPI Configuration
# ============================================
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: alpha
    tags-sorter: alpha
