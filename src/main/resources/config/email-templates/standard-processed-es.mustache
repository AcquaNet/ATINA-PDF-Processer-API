<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #28a745; color: white; padding: 20px; text-align: center; border-radius: 5px 5px 0 0; }
        .header.partial { background: #ffc107; }
        .header.failed { background: #dc3545; }
        .content { background: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
        .footer { background: #f1f1f1; padding: 15px; text-align: center; font-size: 12px; color: #666; border-radius: 0 0 5px 5px; }
        .stats { display: flex; justify-content: space-around; margin: 20px 0; }
        .stat-box { background: white; padding: 15px; text-align: center; border-radius: 5px; flex: 1; margin: 0 5px; }
        .stat-number { font-size: 32px; font-weight: bold; color: #4A90E2; }
        .success { color: #28a745; }
        .failed { color: #dc3545; }
        .extraction { background: white; padding: 15px; margin: 15px 0; border-left: 4px solid #4A90E2; }
        .invoice-data { background: #f8f9fa; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header {{#isFullSuccess}}{{/isFullSuccess}}{{#hasFailures}}{{#hasSuccesses}}partial{{/hasSuccesses}}{{^hasSuccesses}}failed{{/hasSuccesses}}{{/hasFailures}}">
            <h2>{{#isFullSuccess}}‚úì Procesamiento Completo{{/isFullSuccess}}{{#hasFailures}}{{#hasSuccesses}}‚ö†Ô∏è Procesamiento Parcialmente Completo{{/hasSuccesses}}{{^hasSuccesses}}‚úó Procesamiento Fallido{{/hasSuccesses}}{{/hasFailures}}</h2>
        </div>

        <div class="content">
            <p>Hola,</p>

            <p>El proceso de extracci√≥n de documentos para su correo electr√≥nico ha sido completado.</p>

            <div class="stats">
                <div class="stat-box">
                    <div class="stat-number">{{totalFiles}}</div>
                    <div>Total de Archivos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number success">{{extractedFiles}}</div>
                    <div>Extra√≠dos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number failed">{{failedFiles}}</div>
                    <div>Fallidos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number">{{successRate}}%</div>
                    <div>Tasa de √âxito</div>
                </div>
            </div>

            <h3>Resultados de Extracci√≥n</h3>

            {{#extractions}}
            <div class="extraction">
                <h4>üìÑ {{filename}}</h4>
                <p><strong>Estado:</strong> <span class="{{#success}}success{{/success}}{{^success}}failed{{/success}}">{{status}}</span></p>

                {{#success}}
                    {{#hasInvoiceData}}
                    <div class="invoice-data">
                        <strong>Datos Extra√≠dos:</strong><br>
                        {{#invoiceNumber}}‚Ä¢ Factura #: {{invoiceNumber}}<br>{{/invoiceNumber}}
                        {{#invoiceDate}}‚Ä¢ Fecha: {{invoiceDate}}<br>{{/invoiceDate}}
                        {{#total}}‚Ä¢ Importe: {{total}} {{currency}}<br>{{/total}}
                        {{#vendor}}‚Ä¢ Proveedor: {{vendor}}<br>{{/vendor}}
                    </div>
                    {{/hasInvoiceData}}

                    <p style="font-size: 12px; color: #666;">
                        Archivo de resultado: <code>{{resultPath}}</code>
                    </p>
                {{/success}}

                {{^success}}
                <div class="error">
                    <strong>Error:</strong> {{errorMessage}}
                </div>
                {{/success}}
            </div>
            {{/extractions}}

            {{^extractions}}
            <p><em>No se encontraron tareas de extracci√≥n para este correo.</em></p>
            {{/extractions}}

            <p style="margin-top: 30px;">
                <strong>Pr√≥ximos Pasos:</strong><br>
                {{#isFullSuccess}}
                Los datos extra√≠dos han sido enviados a su endpoint de webhook y est√°n listos para su integraci√≥n en sus sistemas.
                {{/isFullSuccess}}
                {{#hasFailures}}
                Por favor revise las extracciones fallidas. Si el problema persiste, contacte a nuestro equipo de soporte con el ID de seguimiento a continuaci√≥n.
                {{/hasFailures}}
            </p>

        </div>

        <div class="footer">
            <p><strong>Atina ‚Äì Conversor de Email</strong></p>
            <p>Sistema automatizado de procesamiento de documentos | <strong>{{tenantName}}</strong></p>
            <p style="font-size: 10px; color: #999;">ID de Email: {{emailId}} | ID de Correlaci√≥n: {{correlationId}}</p>
        </div>
    </div>
</body>
</html>
