
# ============================================
# AI / LLM Configuration
# ============================================
ai:
  provider: openai  # openai | anthropic | ollama

  openai:
    api-key: ${OPENAI_API_KEY}
    model: gpt-5-mini

  anthropic:
    api-key: ${ANTHROPIC_API_KEY:your-key-here}
    model: claude-3-sonnet-20240229

  ollama:
    base-url: http://localhost:11434
    model: llama3


# ============================================
# Application Configuration
# ============================================

spring:

  validation:
    method:
      enabled: false

  application:
    name: invoice-extractor-api

  # ============================================
  # SQL Initialization - DESHABILITADO
  # Usamos DataInitializer en su lugar
  # ============================================
  sql:
    init:
      mode: never  # ⭐ NO usar data.sql

  # ============================================
  # Jackson Configuration
  # ============================================
  jackson:
    serialization:
      write-dates-as-timestamps: false
      indent-output: true
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null

  # ============================================
  # File Upload Configuration
  # ============================================
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 10MB

  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
      chat:
        options:
          model: ${ai.openai.model}
          temperature: 1
          max-completion-tokens: 4000


  # =====================================================
  # HIKARICP CONFIGURATION (Para evitar thread starvation)
  # =====================================================
  datasource:
    hikari:
      maximum-pool-size: 30
      minimum-idle: 10
      leak-detection-threshold: 0
      connection-timeout: 30000
      initialization-fail-timeout: 1
      auto-commit: true
      idle-timeout: 600000
      max-lifetime: 1800000

# ============================================
# Server Configuration
# ============================================
server:
  port: 8080
  servlet:
    context-path: /
  error:
    include-message: always
    include-binding-errors: always

# ============================================
# JWT Configuration - COMPLETO
# ============================================
jwt:
  secret: ${JWT_SECRET:mySecretKeyForJWTTokenGenerationThatIsVeryLongAndSecure123456789}
  expiration: 86400000  # 24 hours in milliseconds
  issuer: ${JWT_ISSUER:invoice-extractor-api}
  header: ${JWT_HEADER:Authorization}
  prefix: ${JWT_PREFIX:Bearer }

# ============================================
# Application Custom Properties
# ============================================
app:
  name: Invoice Extractor API
  version: 1.0.0
  description: AI-powered invoice data extraction engine

  # CORS Configuration
  cors:
    allowed-origins: http://localhost:3000,http://localhost:4200
    allowed-methods: GET,POST,PUT,DELETE,OPTIONS
    allowed-headers: "*"
    max-age: 3600

  # Jobs Configuration
  jobs:
    cleanup-cron: "0 0 2 * * ?"  # ⭐ NUEVO - Ejecutar a las 2 AM todos los días
    cleanup-days: 7  # ⭐ NUEVO - Eliminar jobs más antiguos que 7 días

# ============================================
# Docling Configuration
# ============================================
docling:
  host: ${DOCLING_HOST:docling.localhost}
  port: ${DOCLING_PORT:5001}
  user: ${DOCLING_USER:__admin__}
  pass: ${DOCLING_PASS:admin123}
# ============================================
# Logging Configuration
# ============================================
logging:
  level:
    root: INFO

    #  TRACE para Spring Framework - ver TODOS los errores
    #org.springframework: TRACE
    #org.springframework.beans: TRACE
    #org.springframework.beans.factory: TRACE
    #org.springframework.beans.factory.support: TRACE
    #org.springframework.context: TRACE

    org.springframework: INFO
    org.springframework.scheduling: INFO
    com.atina.invoice.api: DEBUG
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%X{correlationId}] %-5level %logger{36} - %msg%n"

# ============================================
# Actuator Configuration
# ============================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: always

# ============================================
# Swagger/OpenAPI Configuration
# ============================================
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    operations-sorter: alpha
    tags-sorter: alpha

mcp:
  enabled: true

# ============================================
# EMAIL PROCESSING
# ============================================

email:
  crypt:
    # Clave de encriptación para contraseñas
    key-base64: iRC660hR0ACDBVOhHGaz6klFpK7BlcMqVCefR18Iyz0=
  polling:
    # Habilitar/deshabilitar polling automático (scheduler)
    # Si está en false, el scheduler NO se ejecuta automáticamente
    # PERO el controller manual SIGUE FUNCIONANDO
    enabled: true
    # Intervalo de polling en segundos
    interval-seconds: 120000
  # Marcar emails como leídos después de procesarlos
  # true = marca como leído SOLO los que se procesan exitosamente
  # false = no marca nada como leído
  mark-as-read: true